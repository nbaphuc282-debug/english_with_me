<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Electro Mind - HUST Learning Platform</title>
    
    <!-- Tailwind CSS (Design System) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome (Icons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <!-- Custom Config for Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        primary: '#7c3aed', // Violet-600 based on design
                        secondary: '#4f46e5', // Indigo-600
                        accent: '#10b981', // Emerald-500 (Success)
                        danger: '#ef4444', // Red-500 (Error)
                    }
                }
            }
        }
    </script>
    
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #c7c7cc; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a1a1aa; 
        }
        
        /* Animations */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .quiz-option:hover {
            transform: translateX(5px);
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 h-screen flex flex-col overflow-hidden">

    <!-- ================= HEADER / NAVBAR ================= -->
    <header class="bg-white shadow-sm z-20 relative">
        <div class="container mx-auto px-4 h-16 flex items-center justify-between">
            <!-- Logo & Mobile Menu Toggle -->
            <div class="flex items-center gap-4">
                <button id="mobile-menu-btn" class="lg:hidden text-gray-600 text-xl">
                    <i class="fa-solid fa-bars"></i>
                </button>
                <a href="#" onclick="renderHome()" class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-gradient-to-br from-primary to-secondary rounded-lg flex items-center justify-center text-white font-bold text-lg">E</div>
                    <span class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary">Electro Mind</span>
                </a>
            </div>

            <!-- Desktop Navigation -->
            <nav class="hidden lg:flex items-center gap-8 font-medium text-sm text-gray-600">
                <a href="#" onclick="renderHome()" class="hover:text-primary transition">Trang ch·ªß</a>
                <div class="relative group cursor-pointer">
                    <span class="hover:text-primary transition flex items-center gap-1">Kh√≥a h·ªçc <i class="fa-solid fa-chevron-down text-xs"></i></span>
                    <!-- Dropdown Mockup -->
                    <div class="absolute top-full left-0 w-48 bg-white shadow-lg rounded-md p-2 hidden group-hover:block border border-gray-100">
                        <div class="p-2 hover:bg-gray-50 rounded cursor-pointer text-primary">Electrical Engineering</div>
                    </div>
                </div>
                <a href="#" onclick="alert('T√≠nh nƒÉng ƒëang ph√°t tri·ªÉn!')" class="hover:text-primary transition">Luy·ªán t·∫≠p</a>
            </nav>

            <!-- Auth Section -->
            <div id="auth-container" class="flex items-center gap-3">
                <!-- Loading State -->
                <div id="auth-loading" class="hidden text-sm text-gray-500">ƒêang t·∫£i...</div>

                <!-- Guest State -->
                <div id="auth-guest" class="flex items-center gap-3">
                    <button onclick="openAuthModal('login')" class="text-primary font-medium text-sm hover:underline">ƒêƒÉng nh·∫≠p</button>
                    <button onclick="openAuthModal('register')" class="bg-gradient-to-r from-primary to-secondary text-white px-4 py-2 rounded-full text-sm font-medium shadow-lg shadow-primary/30 hover:shadow-xl transition transform hover:-translate-y-0.5">ƒêƒÉng k√Ω</button>
                </div>

                <!-- User State -->
                <div id="auth-user" class="hidden flex items-center gap-3">
                    <span id="user-email" class="text-sm font-medium text-gray-700 hidden md:block"></span>
                    <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-gray-600 border border-gray-300">
                        <i class="fa-regular fa-user"></i>
                    </div>
                    <button onclick="handleLogout()" class="text-gray-500 hover:text-danger text-sm" title="ƒêƒÉng xu·∫•t">
                        <i class="fa-solid fa-right-from-bracket"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- ================= MAIN LAYOUT ================= -->
    <div class="flex flex-1 overflow-hidden relative">
        
        <!-- SIDEBAR (Lesson List) -->
        <aside id="sidebar" class="w-64 bg-white border-r border-gray-200 flex-shrink-0 absolute lg:static h-full z-10 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 shadow-xl lg:shadow-none">
            <div class="p-4 border-b border-gray-100 flex justify-between items-center">
                <h3 class="font-bold text-gray-800">Danh s√°ch b√†i h·ªçc</h3>
                <button class="lg:hidden text-gray-500" onclick="toggleSidebar()"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="overflow-y-auto h-[calc(100%-60px)] p-3 space-y-1" id="lesson-list">
                <!-- Lesson Items will be injected here via JS -->
            </div>
        </aside>

        <!-- MAIN CONTENT AREA -->
        <main class="flex-1 overflow-y-auto bg-slate-50 relative w-full" id="main-content">
            <!-- Dynamic Content will be injected here -->
        </main>

    </div>

    <!-- ================= AUTH MODAL ================= -->
    <div id="auth-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-8 relative animate-fadeIn">
            <button onclick="closeAuthModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                <i class="fa-solid fa-xmark text-xl"></i>
            </button>
            
            <h2 id="modal-title" class="text-2xl font-bold text-center mb-6 text-gray-800">ƒêƒÉng nh·∫≠p</h2>
            
            <form id="auth-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" id="email-input" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none" placeholder="sinhvien@hust.edu.vn" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">M·∫≠t kh·∫©u</label>
                    <input type="password" id="password-input" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <div id="auth-error" class="text-danger text-sm text-center hidden"></div>
                <button type="submit" class="w-full bg-primary text-white py-2.5 rounded-lg font-bold hover:bg-violet-700 transition shadow-lg shadow-primary/30">
                    <span id="submit-btn-text">ƒêƒÉng nh·∫≠p</span>
                </button>
            </form>
            
            <p class="text-center mt-4 text-sm text-gray-600">
                <span id="switch-text">Ch∆∞a c√≥ t√†i kho·∫£n?</span>
                <button onclick="switchAuthMode()" id="switch-btn" class="text-primary font-semibold hover:underline">ƒêƒÉng k√Ω ngay</button>
            </p>
        </div>
    </div>

    <!-- ================= JAVASCRIPT LOGIC ================= -->

    <!-- FIREBASE CONFIG & LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

        // --- 1. CONFIGURATION ---
        // NOTE: User needs to fill this in!
        const firebaseConfig = {
            apiKey: "AIzaSyBPAQ8jldVTwtB_uAzz0-oGcZiUaJ3NeyU",
            authDomain: "ewmp-abc18.firebaseapp.com",
            projectId: "ewmp-abc18",
            storageBucket: "ewmp-abc18.firebasestorage.app",
            messagingSenderId: "416084778745",
            appId: "1:416084778745:web:edb8de27952c3007e24c28"
            measurementId: "G-GVP2MCQNLJ"
        };

        let auth;
        let currentUser = null;

        // Initialize Firebase safely
        try {
            if (firebaseConfig.apiKey) {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
            } else {
                console.warn("Firebase ch∆∞a ƒë∆∞·ª£c c·∫•u h√¨nh. Vui l√≤ng ƒëi·ªÅn API Key trong code.");
            }
        } catch (e) {
            console.error("Firebase Error:", e);
        }

        // --- 2. GLOBAL STATE ---
        window.appState = {
            user: null,
            currentUnitId: null,
            quizScore: 0
        };

        // --- 3. AUTHENTICATION LOGIC ---
        
        // Expose functions to window for HTML onclick attributes
        window.openAuthModal = (mode) => {
            const modal = document.getElementById('auth-modal');
            const title = document.getElementById('modal-title');
            const btnText = document.getElementById('submit-btn-text');
            const switchText = document.getElementById('switch-text');
            const switchBtn = document.getElementById('switch-btn');
            
            window.currentAuthMode = mode; // 'login' or 'register'
            
            if (mode === 'login') {
                title.textContent = 'ƒêƒÉng nh·∫≠p';
                btnText.textContent = 'ƒêƒÉng nh·∫≠p';
                switchText.textContent = 'Ch∆∞a c√≥ t√†i kho·∫£n?';
                switchBtn.textContent = 'ƒêƒÉng k√Ω ngay';
            } else {
                title.textContent = 'ƒêƒÉng k√Ω t√†i kho·∫£n';
                btnText.textContent = 'ƒêƒÉng k√Ω';
                switchText.textContent = 'ƒê√£ c√≥ t√†i kho·∫£n?';
                switchBtn.textContent = 'ƒêƒÉng nh·∫≠p';
            }
            
            modal.classList.remove('hidden');
        };

        window.closeAuthModal = () => {
            document.getElementById('auth-modal').classList.add('hidden');
            document.getElementById('auth-error').classList.add('hidden');
            document.getElementById('auth-form').reset();
        };

        window.switchAuthMode = () => {
            window.openAuthModal(window.currentAuthMode === 'login' ? 'register' : 'login');
        };

        window.handleLogout = async () => {
            if(!auth) return;
            try {
                await signOut(auth);
                alert("ƒê√£ ƒëƒÉng xu·∫•t th√†nh c√¥ng!");
                renderHome(); // Reset view
            } catch (error) {
                console.error(error);
            }
        };

        // Handle Form Submit
        document.getElementById('auth-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            if(!auth) {
                alert("Vui l√≤ng c·∫•u h√¨nh Firebase Config trong code tr∆∞·ªõc!");
                return;
            }

            const email = document.getElementById('email-input').value;
            const password = document.getElementById('password-input').value;
            const errorDiv = document.getElementById('auth-error');
            const submitBtn = document.querySelector('#auth-form button[type="submit"]');

            errorDiv.classList.add('hidden');
            submitBtn.disabled = true;
            submitBtn.classList.add('opacity-50');

            try {
                if (window.currentAuthMode === 'login') {
                    await signInWithEmailAndPassword(auth, email, password);
                } else {
                    await createUserWithEmailAndPassword(auth, email, password);
                }
                window.closeAuthModal();
            } catch (error) {
                errorDiv.textContent = getFriendlyErrorMessage(error.code);
                errorDiv.classList.remove('hidden');
            } finally {
                submitBtn.disabled = false;
                submitBtn.classList.remove('opacity-50');
            }
        });

        // Error Translation
        function getFriendlyErrorMessage(code) {
            switch(code) {
                case 'auth/invalid-email': return 'Email kh√¥ng h·ª£p l·ªá.';
                case 'auth/user-disabled': return 'T√†i kho·∫£n ƒë√£ b·ªã kh√≥a.';
                case 'auth/user-not-found': return 'Kh√¥ng t√¨m th·∫•y t√†i kho·∫£n n√†y.';
                case 'auth/wrong-password': return 'Sai m·∫≠t kh·∫©u.';
                case 'auth/email-already-in-use': return 'Email n√†y ƒë√£ ƒë∆∞·ª£c ƒëƒÉng k√Ω.';
                case 'auth/weak-password': return 'M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±.';
                default: return 'ƒê√£ c√≥ l·ªói x·∫£y ra: ' + code;
            }
        }

        // Auth State Listener
        if(auth) {
            onAuthStateChanged(auth, (user) => {
                window.appState.user = user;
                updateAuthUI(user);
            });
        } else {
            // Fallback UI for demo without config
            updateAuthUI(null); 
        }

        function updateAuthUI(user) {
            const guestDiv = document.getElementById('auth-guest');
            const userDiv = document.getElementById('auth-user');
            const loadingDiv = document.getElementById('auth-loading');
            const userEmailSpan = document.getElementById('user-email');

            loadingDiv.classList.add('hidden');

            if (user) {
                guestDiv.classList.add('hidden');
                userDiv.classList.remove('hidden');
                userDiv.classList.add('flex');
                userEmailSpan.textContent = `Xin ch√†o, ${user.email}`;
                
                // Re-render content if in a protected area
                const main = document.getElementById('main-content');
                if (main.querySelector('#locked-message')) {
                   renderUnit(window.appState.currentUnitId);
                }
            } else {
                guestDiv.classList.remove('hidden');
                userDiv.classList.add('hidden');
                userDiv.classList.remove('flex');
            }
        }
    </script>

    <!-- CONTENT DATA & UI LOGIC -->
    <script>
        // --- 4. COURSE DATA (Extracted from Word File) ---
        // Only populating first few units fully for clean code demonstration.
        // The structure supports all 10 units.
        
        const courseData = [
            {
                id: 1,
                title: "Unit 1: Electrons",
                icon: "fa-atom",
                desc: "Understanding the basic building blocks of matter.",
                vocabulary: [
                    { word: "Electric charge", ipa: "/…™Ààlek.tr…™k ,t É…ëÀêd í/", mean: "ƒêi·ªán t√≠ch" },
                    { word: "Positive charge", ipa: "/Ààp…íz.…ô.t…™v ,t É…ëÀêd í/", mean: "ƒêi·ªán t√≠ch d∆∞∆°ng" },
                    { word: "Negative charge", ipa: "/Ààne…°.…ô.t…™v,t É…ëÀêd í/", mean: "ƒêi·ªán t√≠ch √¢m" },
                    { word: "Nucleus", ipa: "/ÀànjuÀê.kli.…ôs/", mean: "H·∫°t nh√¢n" },
                    { word: "Neutron", ipa: "/ÀànjuÀê.tr…ín/", mean: "N∆°-t-r√¥ng" },
                    { word: "Isotopes", ipa: "/Ààa…™.s…ô.t…ô äp/", mean: "ƒê·ªìng v·ªã" }
                ],
                essay: `
                    <h4 class="font-bold text-lg mb-2">Atomic Structure</h4>
                    <p class="mb-3">Atoms consist of an extremely small, positively charged nucleus surrounded by a cloud of negatively charged electrons. Although typically the nucleus is less than one ten-thousandth the size of the atom, the nucleus contains more that 99.9% of the mass of the atom.</p>
                    <p class="mb-3">Nuclei are made of positively charged protons and electrically neutral neutrons held together by a nuclear force. This force is much stronger than the electrostatic force that binds electrons to the nucleus, but its range is limited to distances of the order of 1 x 10-15 meters.</p>
                    <div class="my-4 p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500 italic">
                        "Atoms of the same element can have different number of neutrons and they are called isotopes of that element. Example: hydrogen-1, hydrogen-2 (deuterium)."
                    </div>
                `,
                quiz: [
                    { q: "What is the approximate fraction of an atom‚Äôs mass found in the nucleus?", options: ["About 10%", "About 50%", "More than 99.9%", "Less than 1%"], correct: 2 },
                    { q: "Which particles are found in the nucleus?", options: ["Electrons only", "Protons and electrons", "Protons and neutrons", "Neutrons and electrons"], correct: 2 },
                    { q: "What type of force holds protons and neutrons together?", options: ["Gravitational", "Nuclear force", "Electrostatic", "Magnetic"], correct: 1 },
                    { q: "The atomic number (Z) is defined as the number of:", options: ["Neutrons", "Protons", "Electrons", "Nucleons"], correct: 1 },
                    { q: "Isotopes of an element have the same number of:", options: ["Neutrons", "Protons", "Electrons", "Atomic mass"], correct: 1 }
                ]
            },
            {
                id: 2,
                title: "Unit 2: Electric Current",
                icon: "fa-bolt",
                desc: "Flow of charge, carriers, and circuits.",
                vocabulary: [
                    { word: "Current", ipa: "/Ààk år.…ônt/", mean: "D√≤ng ƒëi·ªán" },
                    { word: "Charge carrier", ipa: "/t É…ëÀêd í Ààk√¶r.i.…ôr/", mean: "H·∫°t mang ƒëi·ªán" },
                    { word: "Conductor", ipa: "/k…ônÀàd åk.t…ôr/", mean: "V·∫≠t d·∫´n ƒëi·ªán" },
                    { word: "Drift velocity", ipa: "/dr…™ft v…ôÀàl…ís.…ô.ti/", mean: "V·∫≠n t·ªëc tr√¥i" }
                ],
                essay: `
                    <h4 class="font-bold text-lg mb-2">Nature of Electric Current</h4>
                    <p class="mb-3">When a battery is connected to a bulb to make a complete circuit, there is an electric current everywhere in the circuit. Something flows steadily. That thing is charge.</p>
                    <p>In metallic wires, the electrons are the moving charged particles. They are simply part of the atoms that make up the battery, wires and bulb. The current is the same at each point in the single circuit loop ‚Äì there are no leaks!</p>
                `,
                quiz: [
                    { q: "What flows steadily in a complete electric circuit?", options: ["Energy", "Charge", "Heat", "Waves"], correct: 1 },
                    { q: "In metallic wires, the charge carriers are:", options: ["Positive ions", "Negative electrons", "Protons", "Neutrons"], correct: 1 },
                    { q: "Where is the current the same in a series circuit?", options: ["Near battery", "Near bulb", "Everywhere", "Nowhere"], correct: 2 }
                ]
            },
            {
                id: 3,
                title: "Unit 3: Cells and Batteries",
                icon: "fa-battery-full",
                desc: "Primary cells, secondary cells, and applications.",
                vocabulary: [
                     { word: "Battery", ipa: "/Ààb”ït…ôri/", mean: "Pin/·∫Æc quy" },
                     { word: "Rechargeable", ipa: "/riÀêÀàt É…ëÀê.d í…ô.b…ôl/", mean: "C√≥ th·ªÉ s·∫°c l·∫°i" },
                     { word: "Electrode", ipa: "/iÀàlektr…ôud/", mean: "ƒêi·ªán c·ª±c" }
                ],
                essay: "<p>An Electric Cell is a power-generating device that converts stored chemical energy into electrical energy. A battery is a combination of cells connected in series or parallel.</p>",
                quiz: [
                    { q: "Which type of cell cannot be recharged?", options: ["Primary cell", "Secondary cell", "Fuel cell", "Reserve cell"], correct: 0 },
                    { q: "A battery is defined as:", options: ["A single cell", "A combination of cells", "A generator", "An insulator"], correct: 1 }
                ]
            },
            { id: 4, title: "Unit 4: Sources of Power", icon: "fa-solar-panel", desc: "Generation, transmission, and renewables.", vocabulary: [], essay: "<p>Content for Unit 4...</p>", quiz: [] },
            { id: 5, title: "Unit 5: Mains Electricity", icon: "fa-plug", desc: "AC/DC, safety, plugs and fuses.", vocabulary: [], essay: "<p>Content for Unit 5...</p>", quiz: [] },
            { id: 6, title: "Unit 6: Electricity & Magnetism", icon: "fa-magnet", desc: "Fields, flux, and electromagnetism.", vocabulary: [], essay: "<p>Content for Unit 6...</p>", quiz: [] },
            { id: 7, title: "Unit 7: Resistors", icon: "fa-microchip", desc: "Ohm's law, types of resistors.", vocabulary: [], essay: "<p>Content for Unit 7...</p>", quiz: [] },
            { id: 8, title: "Unit 8: Capacitors", icon: "fa-layer-group", desc: "Storing charge, dielectrics.", vocabulary: [], essay: "<p>Content for Unit 8...</p>", quiz: [] },
            { id: 9, title: "Unit 9: Inductors", icon: "fa-ring", desc: "Magnetic energy storage, coils.", vocabulary: [], essay: "<p>Content for Unit 9...</p>", quiz: [] },
            { id: 10, title: "Unit 10: Semiconductors", icon: "fa-memory", desc: "Diodes, P-N junctions, LEDs.", vocabulary: [], essay: "<p>Content for Unit 10...</p>", quiz: [] },
        ];

        const leaderboardData = [
            { name: "Nguy·ªÖn VƒÉn A", score: 980, avatar: "NV" },
            { name: "Tr·∫ßn Th·ªã B", score: 950, avatar: "TT" },
            { name: "L√™ Ho√†ng C", score: 890, avatar: "LH" },
            { name: "Ph·∫°m Minh D", score: 850, avatar: "PM" },
            { name: "Ho√†ng Anh E", score: 820, avatar: "HA" },
        ];

        // --- 5. UI RENDERING LOGIC ---

        function renderSidebar() {
            const list = document.getElementById('lesson-list');
            list.innerHTML = courseData.map(unit => `
                <div onclick="renderUnit(${unit.id})" class="cursor-pointer p-3 rounded-lg hover:bg-violet-50 group transition flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-gray-100 text-gray-500 flex items-center justify-center group-hover:bg-primary group-hover:text-white transition text-xs">
                        <i class="fa-solid ${unit.icon}"></i>
                    </div>
                    <div>
                        <p class="text-sm font-semibold text-gray-700 group-hover:text-primary">${unit.title}</p>
                        <p class="text-xs text-gray-400 truncate w-32">${unit.desc}</p>
                    </div>
                </div>
            `).join('');
        }

        // Render Landing Page / Dashboard
        window.renderHome = () => {
            const main = document.getElementById('main-content');
            window.appState.currentUnitId = null;
            
            main.innerHTML = `
                <!-- Hero Banner -->
                <div class="bg-gradient-to-r from-primary to-secondary text-white p-8 md:p-12 relative overflow-hidden">
                    <div class="relative z-10 max-w-2xl">
                        <h1 class="text-3xl md:text-4xl font-bold mb-4">H·ªçc Ti·∫øng Anh chuy√™n ng√†nh ƒêi·ªán - ƒêi·ªán T·ª≠</h1>
                        <p class="text-blue-100 mb-6 text-lg">N·ªÅn t·∫£ng h·ªó tr·ª£ sinh vi√™n HUST (FL1 & FL2) n·∫Øm v·ªØng t·ª´ v·ª±ng v√† ki·∫øn th·ª©c chuy√™n ng√†nh.</p>
                        ${!window.appState.user ? 
                            `<button onclick="openAuthModal('login')" class="bg-white text-primary px-6 py-3 rounded-full font-bold hover:bg-gray-100 transition shadow-lg">B·∫Øt ƒë·∫ßu ngay >></button>` : 
                            `<button onclick="renderUnit(1)" class="bg-accent text-white px-6 py-3 rounded-full font-bold hover:bg-emerald-600 transition shadow-lg">Ti·∫øp t·ª•c h·ªçc Unit 1 >></button>`
                        }
                    </div>
                    <!-- Abstract Decoration -->
                    <div class="absolute right-0 bottom-0 opacity-20 transform translate-x-1/4 translate-y-1/4">
                         <i class="fa-solid fa-atom text-[300px]"></i>
                    </div>
                </div>

                <div class="p-6 md:p-8 max-w-6xl mx-auto">
                    <!-- Stats / Features -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex items-center gap-4">
                            <div class="w-12 h-12 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xl"><i class="fa-solid fa-book-open"></i></div>
                            <div><h4 class="font-bold">10 Unit</h4><p class="text-sm text-gray-500">Ki·∫øn th·ª©c chu·∫©n</p></div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex items-center gap-4">
                            <div class="w-12 h-12 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center text-xl"><i class="fa-solid fa-gamepad"></i></div>
                            <div><h4 class="font-bold">Gamification</h4><p class="text-sm text-gray-500">V·ª´a h·ªçc v·ª´a ch∆°i</p></div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex items-center gap-4">
                            <div class="w-12 h-12 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center text-xl"><i class="fa-solid fa-trophy"></i></div>
                            <div><h4 class="font-bold">X·∫øp h·∫°ng</h4><p class="text-sm text-gray-500">Thi ƒëua th√†nh t√≠ch</p></div>
                        </div>
                    </div>

                    <!-- Leaderboard Section (Only visible if logged in) -->
                    ${window.appState.user ? renderLeaderboardHTML() : ''}
                </div>
            `;
        };

        function renderLeaderboardHTML() {
            return `
                <div class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden fade-in">
                    <div class="bg-yellow-50 p-4 border-b border-yellow-100 flex justify-between items-center">
                        <h3 class="text-lg font-bold text-yellow-800"><i class="fa-solid fa-crown mr-2"></i>B·∫£ng V√†ng Th√†nh T√≠ch</h3>
                        <span class="text-xs font-semibold bg-yellow-200 text-yellow-800 px-2 py-1 rounded">Tu·∫ßn n√†y</span>
                    </div>
                    <div class="divide-y divide-gray-100">
                        ${leaderboardData.map((u, index) => `
                            <div class="flex items-center justify-between p-4 hover:bg-gray-50">
                                <div class="flex items-center gap-4">
                                    <div class="font-bold text-gray-400 w-6 text-center">${index + 1}</div>
                                    <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-gray-200 to-gray-300 flex items-center justify-center text-sm font-bold text-gray-600">
                                        ${u.avatar}
                                    </div>
                                    <span class="font-medium text-gray-700">${u.name}</span>
                                </div>
                                <div class="font-bold text-primary">${u.score} pts</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // Render Specific Unit Content
        window.renderUnit = (unitId) => {
            window.appState.currentUnitId = unitId;
            const unit = courseData.find(u => u.id === unitId);
            const main = document.getElementById('main-content');

            // Close mobile sidebar if open
            document.getElementById('sidebar').classList.add('-translate-x-full');

            main.innerHTML = `
                <div class="max-w-4xl mx-auto p-6 pb-24 fade-in">
                    <!-- Header -->
                    <div class="mb-8 border-b pb-4">
                        <div class="flex items-center gap-2 text-sm text-primary font-semibold mb-2">
                            <span onclick="renderHome()" class="cursor-pointer hover:underline">Trang ch·ªß</span> / <span>${unit.title}</span>
                        </div>
                        <h2 class="text-3xl font-bold text-gray-900">${unit.title}</h2>
                        <p class="text-gray-500 mt-2">${unit.desc}</p>
                    </div>

                    <!-- Content Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        
                        <!-- Left: Learning Content -->
                        <div class="lg:col-span-2 space-y-8">
                            
                            <!-- Vocabulary Section -->
                            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                                <div class="bg-blue-50 px-6 py-3 border-b border-blue-100">
                                    <h3 class="font-bold text-blue-800"><i class="fa-solid fa-language mr-2"></i>Vocabulary</h3>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-sm text-left">
                                        <thead class="text-xs text-gray-500 uppercase bg-gray-50">
                                            <tr>
                                                <th class="px-6 py-3">Word</th>
                                                <th class="px-6 py-3">Pronunciation</th>
                                                <th class="px-6 py-3">Meaning</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-gray-100">
                                            ${unit.vocabulary.length ? unit.vocabulary.map(v => `
                                                <tr class="hover:bg-gray-50">
                                                    <td class="px-6 py-4 font-medium text-gray-900">${v.word}</td>
                                                    <td class="px-6 py-4 font-mono text-gray-500 text-xs">${v.ipa}</td>
                                                    <td class="px-6 py-4 text-gray-600">${v.mean}</td>
                                                </tr>
                                            `).join('') : '<tr><td colspan="3" class="p-4 text-center text-gray-400">ƒêang c·∫≠p nh·∫≠t...</td></tr>'}
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Reading/Essay Section -->
                            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 text-gray-700 leading-relaxed">
                                ${unit.essay}
                            </div>

                        </div>

                        <!-- Right: Gamification Sidebar -->
                        <div class="lg:col-span-1">
                            <div class="sticky top-4 space-y-6">
                                
                                <!-- Quiz Card -->
                                <div class="bg-white rounded-xl shadow-lg border border-purple-100 overflow-hidden relative">
                                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-primary to-secondary"></div>
                                    <div class="p-6 text-center">
                                        <div class="w-16 h-16 bg-purple-100 text-primary rounded-full flex items-center justify-center text-2xl mx-auto mb-4 animate-bounce">
                                            <i class="fa-solid fa-puzzle-piece"></i>
                                        </div>
                                        <h3 class="text-xl font-bold text-gray-800 mb-2">√în t·∫≠p nhanh</h3>
                                        <p class="text-sm text-gray-500 mb-6">Ki·ªÉm tra ki·∫øn th·ª©c c·ªßa b·∫°n qua ${unit.quiz.length} c√¢u h·ªèi tr·∫Øc nghi·ªám.</p>
                                        
                                        ${window.appState.user ? 
                                            `<button onclick="startQuiz(${unitId})" class="w-full bg-primary text-white py-3 rounded-lg font-bold hover:bg-violet-700 transition shadow-lg shadow-primary/30">B·∫Øt ƒë·∫ßu ngay</button>` :
                                            `<div class="bg-gray-50 p-3 rounded text-sm text-gray-500 border border-gray-200">
                                                <i class="fa-solid fa-lock mr-1"></i> ƒêƒÉng nh·∫≠p ƒë·ªÉ l√†m b√†i t·∫≠p
                                            </div>`
                                        }
                                    </div>
                                </div>

                                <!-- Video Resources (Static Mockup) -->
                                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
                                    <h4 class="font-bold text-gray-800 mb-3 text-sm">Video tham kh·∫£o</h4>
                                    <a href="https://www.youtube.com/@EngineeringMindset" target="_blank" class="block group">
                                        <div class="relative rounded-lg overflow-hidden aspect-video bg-gray-900 mb-2">
                                            <img src="https://img.youtube.com/vi/hsldXsJ5H_c/mqdefault.jpg" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition">
                                            <div class="absolute inset-0 flex items-center justify-center">
                                                <i class="fa-solid fa-play-circle text-white text-4xl"></i>
                                            </div>
                                        </div>
                                        <p class="text-xs font-medium text-gray-700 group-hover:text-primary">The Engineering Mindset</p>
                                    </a>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            `;
        }

        // --- 6. GAMIFICATION LOGIC (QUIZ) ---

        window.startQuiz = (unitId) => {
            const unit = courseData.find(u => u.id === unitId);
            if (!unit || unit.quiz.length === 0) {
                alert("B√†i t·∫≠p cho unit n√†y ƒëang ƒë∆∞·ª£c c·∫≠p nh·∫≠t.");
                return;
            }

            const main = document.getElementById('main-content');
            let currentQuestionIndex = 0;
            let score = 0;

            // Render Quiz Interface
            const renderQuestion = () => {
                if (currentQuestionIndex >= unit.quiz.length) {
                    // Finish
                    main.innerHTML = `
                        <div class="min-h-full flex items-center justify-center p-4 fade-in">
                            <div class="bg-white p-8 rounded-2xl shadow-xl text-center max-w-md w-full">
                                <div class="text-6xl mb-4">üéâ</div>
                                <h2 class="text-2xl font-bold text-gray-800 mb-2">Ho√†n th√†nh!</h2>
                                <p class="text-gray-600 mb-6">B·∫°n ƒë√£ tr·∫£ l·ªùi ƒë√∫ng <span class="text-primary font-bold text-xl">${score}/${unit.quiz.length}</span> c√¢u h·ªèi.</p>
                                <div class="flex gap-3 justify-center">
                                    <button onclick="renderUnit(${unitId})" class="px-6 py-2 border border-gray-300 rounded-lg font-medium hover:bg-gray-50">H·ªçc l·∫°i</button>
                                    <button onclick="renderHome()" class="px-6 py-2 bg-primary text-white rounded-lg font-medium hover:bg-violet-700">V·ªÅ trang ch·ªß</button>
                                </div>
                            </div>
                        </div>
                    `;
                    return;
                }

                const q = unit.quiz[currentQuestionIndex];
                
                main.innerHTML = `
                    <div class="max-w-2xl mx-auto p-6 mt-10 fade-in">
                        <div class="mb-6 flex justify-between items-center">
                            <button onclick="renderUnit(${unitId})" class="text-gray-500 hover:text-gray-800"><i class="fa-solid fa-arrow-left mr-2"></i>Tho√°t</button>
                            <span class="bg-purple-100 text-primary px-3 py-1 rounded-full text-xs font-bold">C√¢u ${currentQuestionIndex + 1}/${unit.quiz.length}</span>
                        </div>

                        <div class="bg-white rounded-2xl shadow-lg border border-gray-200 p-8">
                            <h3 class="text-xl font-bold text-gray-800 mb-6">${q.q}</h3>
                            
                            <div class="space-y-3" id="options-container">
                                ${q.options.map((opt, idx) => `
                                    <button onclick="checkAnswer(${idx})" class="quiz-option w-full text-left p-4 rounded-xl border-2 border-gray-100 hover:border-primary hover:bg-purple-50 transition duration-200 font-medium text-gray-600" id="opt-${idx}">
                                        ${opt}
                                    </button>
                                `).join('')}
                            </div>

                            <div id="feedback-area" class="mt-6 hidden">
                                <div id="feedback-msg" class="p-4 rounded-lg mb-4 font-bold text-center"></div>
                                <button onclick="nextQuestion()" class="w-full bg-gray-800 text-white py-3 rounded-lg font-bold hover:bg-black">C√¢u ti·∫øp theo <i class="fa-solid fa-arrow-right ml-2"></i></button>
                            </div>
                        </div>
                    </div>
                `;
            };

            window.checkAnswer = (selectedIndex) => {
                const q = unit.quiz[currentQuestionIndex];
                const isCorrect = selectedIndex === q.correct;
                const container = document.getElementById('options-container');
                const feedbackArea = document.getElementById('feedback-area');
                const feedbackMsg = document.getElementById('feedback-msg');

                // Disable all buttons
                const buttons = container.querySelectorAll('button');
                buttons.forEach(btn => btn.disabled = true);

                // Style buttons
                const selectedBtn = document.getElementById(`opt-${selectedIndex}`);
                const correctBtn = document.getElementById(`opt-${q.correct}`);

                if (isCorrect) {
                    selectedBtn.classList.remove('border-gray-100', 'hover:border-primary');
                    selectedBtn.classList.add('bg-green-100', 'border-green-500', 'text-green-800');
                    feedbackMsg.className = "p-4 rounded-lg mb-4 font-bold text-center bg-green-100 text-green-800";
                    feedbackMsg.innerHTML = `<i class="fa-solid fa-check-circle mr-2"></i>Ch√≠nh x√°c! Xu·∫•t s·∫Øc.`;
                    score++;
                } else {
                    selectedBtn.classList.remove('border-gray-100', 'hover:border-primary');
                    selectedBtn.classList.add('bg-red-100', 'border-red-500', 'text-red-800');
                    
                    // Show correct answer
                    correctBtn.classList.add('bg-green-100', 'border-green-500', 'text-green-800');

                    feedbackMsg.className = "p-4 rounded-lg mb-4 font-bold text-center bg-red-100 text-red-800";
                    feedbackMsg.innerHTML = `<i class="fa-solid fa-times-circle mr-2"></i>Sai r·ªìi! ƒê√°p √°n ƒë√∫ng l√† m√†u xanh.`;
                }

                feedbackArea.classList.remove('hidden');
                
                // Attach next function globally temporarily so the button can call it
                window.nextQuestion = () => {
                    currentQuestionIndex++;
                    renderQuestion();
                }
            };

            renderQuestion();
        };


        // --- 7. INITIALIZATION & MOBILE MENU ---

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            if (sidebar.classList.contains('-translate-x-full')) {
                sidebar.classList.remove('-translate-x-full');
            } else {
                sidebar.classList.add('-translate-x-full');
            }
        }

        document.getElementById('mobile-menu-btn').addEventListener('click', toggleSidebar);

        // Init
        renderSidebar();
        renderHome(); // Start at home

    </script>
</body>
</html>
